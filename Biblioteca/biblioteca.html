<!DOCTYPE html>
<html lang="it">
<head>
    <style>
        table {
            width: 100%;
            border-block: 1px solid #000;
        }
        body,h1,h2,p,ul,li {
            font-family: Arial, sans-serif;
            width: 100%;
            margin: auto;
            max-width: 800px;
            padding: 0.5em;
        }
        button {
            padding: 0.3em 0.6em;
            font-size: 0.9em;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca - Visualizzazione Libri</title>
</head>
<body>
    <h1>La Mia Biblioteca</h1>
    
    <p><a href="index.html">‚Üê Aggiungi nuovo libro</a></p>

    <h2>Statistiche</h2>
    <h4>
    <div>
    Libri totali: <span id="totalBooks">-</span>
    </div>
    <div>
    Autori: <span id="totalAuthors">-</span>
    </div>
    <div>
    Media pagine: <span id="avgPages">-</span>
    </div>
    </h4>
    
    <p>
        <button onclick="loadLibrary()">Aggiorna</button>
    </p>

    <h2>Lista Libri</h2>
    <div id="content"></div>

    <script>
        const STORAGE_KEY = 'biblioteca';

        function leggiBiblioteca() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : { metadata: {}, libri: [] };
        }

        function salvaBiblioteca(biblioteca) {
            biblioteca.metadata.ultimaModifica = new Date().toISOString();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(biblioteca));
        }

        function deleteBook(index) {
            const biblioteca = leggiBiblioteca();
            biblioteca.libri.splice(index, 1);
            salvaBiblioteca(biblioteca);
            loadLibrary();
        }

        function loadLibrary() {
            const contentDiv = document.getElementById('content');
            const biblioteca = leggiBiblioteca();
            const libri = biblioteca.libri || [];
            
            // Aggiorna statistiche
            document.getElementById('totalBooks').textContent = libri.length;
            
            const autoriUnici = [...new Set(libri.map(l => l.autore))];
            document.getElementById('totalAuthors').textContent = autoriUnici.length;
            
            const libriConPagine = libri.filter(l => l.pagine);
            const mediaPagine = libriConPagine.length > 0 
                ? Math.round(libriConPagine.reduce((sum, l) => sum + l.pagine, 0) / libriConPagine.length)
                : '-';
            document.getElementById('avgPages').textContent = mediaPagine;

            let tableHTML = `
                <table border="1">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Titolo</th>
                            <th>Autore</th>
                            <th>Anno</th>
                            <th>Genere</th>
                            <th>Pagine</th>
                            <th>ISBN</th>
                            <th>Azioni</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            libri.forEach((libro, index) => {
                tableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${libro.titolo}</td>
                        <td>${libro.autore}</td>
                        <td>${libro.anno}</td>
                        <td>${libro.genere || '-'}</td>
                        <td>${libro.pagine || '-'}</td>
                        <td>${libro.isbn || '-'}</td>
                        <td><button onclick="deleteBook(${index})">Elimina</button></td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            contentDiv.innerHTML = tableHTML;
        }

        // Carica la biblioteca all'avvio
        loadLibrary();
    </script>
</body>
</html>
